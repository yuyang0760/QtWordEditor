# 样式更新实际流程

## 1. 触发光标移动 (Cursor::positionChanged)
    1.1. 判断是否有选区
        1.1.1 有选区 → 不更新样式
        1.1.2 无选区
            1.1.2.1 调用 getCurrentDisplayStyle() 获取光标位置前面字符的样式 保存到 displayStyle 和currentStyle中
            1.1.2.2 利用 displayStyle 变量 更新工具栏样式

## 2. 触发选区变化 (Selection::selectionChanged)
    2.1. 只更新光标可见性，不更新样式

## 3. 触发选择完成 (EditEventHandler::selectionFinished)
    3.1. 鼠标松开，选择完成
    3.2. 调用 updateStyleState() 更新样式
        3.2.1 调用 getCurrentDisplayStyle() 获取样式
        3.2.2 判断是否有选区
        3.2.3 无选区：调用 updateFromSelection(style, true)
        3.2.4 有选区：
            3.2.4.1 检查是否在单个 Span 内
            3.2.4.2 单个 Span：调用 updateFromSelection(style, true)
            3.2.4.3 跨多个 Span：
                3.2.4.3.1 调用 getSelectionStyleConsistency() 获取每个属性的一致性
                3.2.4.3.2 调用 updateFromSelection(style, ribbonConsistency)
